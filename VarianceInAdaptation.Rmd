---
title: "Sensory and Motor Variance in Adaptation and Proprioceptive Recalibration"
author: "Marius 't Hart"
date: "20/11/2022"
output:
  word_document: default
  html_document: default
  pdf_document: default
---

```{r setup_knitr, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Variance in movements has sometimes been seen as a measure of exploration, which is thought to support motor adaptation. For example, people with larger movement variability may adapt to a perturbation quicker.

Similarly, if localization of an unseen hand after an outward reach depends on proprioception, and this sensory signal may be recalibrated, then a maximum likelihood approach would predict that people with less reliable (i.e. more variable) proprioception, recalibrated proprioception to a larger degree.

We have published four papers on related topics, that all use the same paradigm. Here we combine all this data to have a suitable data set to probe questions related to the role that variance has in adaptation processes. For some questions, we can include pilot data where no adaptation was recorded (i.e. only aligned sessions are available).

We start by installing a package with generic functions for analyzing reach data.

```{r get_reach_package}
if (!require(Reach)) {
  if (!require(devtools)) {
    install.packages(devtools)
  }
  devtools::install_github('thartbm/Reach', ref='main', force=TRUE)
}
library(Reach)
```

Now we load all the functions used specifically for this project. They are separated in source files, grouped by topic:

```{r source_R_code}
# here are some general utility functions:
source('R/util.R')
# this does data pre-processing:
source('R/data.R')
# make plots/figures:
source('R/figures.R')
# extra crappy things:
source('R/try_out.R')
```


Now we are ready to download the full data set:

```{r download_data}
# from the data set, we are interested in groups that all learned the
# same 30 degree rotation, without instructions


# 'control', 'instructed', 'control60', 'instructed60',
# 'cursorjump', 'handview', 'older_control', 'older_instructed'
# 'EDS', 'EDSmatch', 'org_control', 'org_instructed', 'org_control60', and
# 'org_instructed60'

groups<- c('control',
           'instructed',
           'control60',
           'instructed60',
           'cursorjump',
           'handview',
           'older_control',
           'older_instructed',
           'EDS',
           'EDSmatch'
)

# downloadData(folder='data', 
#              unzip=TRUE, 
#              removezips=TRUE, 
#              checkfiles=TRUE, 
#              groups=groups, 
#              sections=c('aligned','rotated'), 
#              overwrite=TRUE)


groups <- c(
           'org_control',
           'org_instructed',
           'org_control60',
           'org_instructed60'
           )

# downloadData(folder='data', 
#              unzip=TRUE, 
#              removezips=TRUE, 
#              checkfiles=TRUE, 
#              groups=groups, 
#              sections=c('aligned','rotated'), 
#              overwrite=TRUE)


```

And we can test if all of the data is there:

```{r check_data}

groups <- c('control',
            'instructed',
            'control60',
            'instructed60',
            'cursorjump',
            'handview',
            'older_control',
            'older_instructed',
            'EDS',
            'EDSmatch'
            )

sessions <- c('aligned',
              'rotated')

tasks <- c('training',
           'activelocalization',
           'passivelocalization',
           'nocursor')

# dataChecks( groups   = groups, 
#             sessions = sessions, 
#             tasks    = tasks )
  
groups <- c('org_control',
            'org_instructed',
            'org_control60',
            'org_instructed60')
sessions <- c('aligned')

# dataChecks( groups   = groups, 
#             sessions = sessions, 
#             tasks    = tasks )
  
```

One participants seems to be missing a block of 9 trials from each of the 4 kinds of localization, but other than that, there are only one or two trials missing from each participant. This is workable data.

As a final preparation we get a file with descriptors for several measurements for every participant. This also takes some time, but has to be done only once.

```{r get_descriptors_file}
# getAllDescriptors()
```

# Before adaptation

What is the variance in all these measures?

First, we look at reaches with and without feedback:

1. reach training variability
2. open-loop reach variability
3. relation

```{r baseline_reach_variability, fig.width=8, fig.height=4}

plotBaselineVariability(groups='all',
                        x='training',
                        y='nocursor')

```


Then, we look at active and passive hand localization:

4. active hand localization variability
5. passive hand localization variability
6. relation

```{r baseline_localization_variability, fig.width=8, fig.height=4}

plotBaselineVariability(groups='all',
                        x='activelocalization',
                        y='passivelocalization')

```


# After adaptation

## Predicting localization shifts

If the sensory modality with the larger uncertainty is the one that gets recalibrated the most, then does it also make sense that people with larger localization variance recalibrate proprioception more?

If so, we ask: does higher variance in hand localization relate to larger or smaller shifts in hand localization after training?

Is this different for active or passive localization? Or should we be looking at the difference?

```{r localization_shifts}
plotPredictedAdaptation(IVs=c('activelocalization_sd',   'passivelocalization_sd'),
                        DVs=c('activelocalization_shift','passivelocalization_shift'),
                        groups=c("handview", "instructed60", "older_instructed", "control60", "EDSmatch", "instructed", "cursorjump", "EDS", "control", "older_control") )
```


## Predicting adaptation rate

Here we explore the exploration-exploitation hypothesis: people with more reach variance learn/adapt faster because they can exploit what they learn during this exploration.

Is the speed of adaptation related to any of the baseline reach variance measures?

```{r adaptation_rate}

plotPredictedAdaptation(IVs=c('training_sd',  'nocursor_sd',   'training_sd',        'nocursor_sd'),
                        DVs=c('training_rate','training_rate', 'training_asymptote', 'training_asymptote'),
                        groups=c('control','EDS','EDSmatch','older_control','cursorjump'))


```


## Predicting adaptation asymptote

Maybe it's not the rate of change that is predicted, but the asymptote: how much you learn or adapt?

Is the amount of adaptation related to any of the baseline variance measures?

(Plotted above: bottom row.)

## Predicting reach aftereffects

Are with/without strategy reach aftereffects related to any of the baseline variance measures? (In particular variance in baseline no-cursor reach deviations.)

```{r RAE_predictors}
plotPredictedAdaptation(IVs=c('training_sd', 'nocursor_sd', 'training_sd', 'nocursor_sd'),
                        DVs=c('exclusion',   'exclusion',   'inclusion',   'inclusion'),
                        groups=c('control','EDS','EDSmatch','older_control','cursorjump'))
```


# Demographics

Here we could look at effects of age, sex and other demographics.

## Variability in Localization and Sex

This is the effect of sex on aligned localization variability. We only look at people who self-identified their biological sex as male or female:

```{r variability_sex}
plotBaselineVariabilitySex()
```
There is some evidence that biases in reaching depend on sex, so we might also want to test that.

# Try out plots

Here are some things I was apparently trying out.

## Decay of Localization Bias

Decay of localization biases across the 18 trials of each rotated block. There might be a break point between trials 9 and 10, as each participant only does the first or second half as active or passive localization.

```{r localization_decay_plot}
plotLocalizationDecay()
```

To check: only for active localization, early on in the rotated session is there some form of decay. Later on it stabilizes. Does it stabilize at the same point as where passive localization is?

## Decay of Reach Aftereffects

Decay of reach aftereffects across the 18 trials of each rotated no-cursor block. These are only groups/conditions with normal feedback, a 30 degree rotation and without instructions about the rotation (4 groups: 'control', 'older_control', 'EDS' and 'EDSmatch'). This figure/data set is split by Exclude first and Include first, but each row of panels in the figures is based on the same subset of participants, and each participant only contributes to 1 row of panels.

```{r RAE_decay_plot}
plotRAEdecay()
```

There might be some subtle differences, e.g., include strategy reach aftereffects are higher than exclude strategy reach aftereffects in blocks where you start with include strategy no-cursor trials.

# No-cursors predicted by variance in proprioception

Is variance in no-cursor reaches predicted by localization?

```{r nocursorsd_propsd}
plotPredictedAdaptation(IVs=c('activelocalization_sd', 'passivelocalization_sd'),
                        DVs=c('aligned_nocursor_sd',   'aligned_nocursor_sd'),
                        groups=c("handview", "instructed60", "older_instructed", "control60", "EDSmatch", "instructed", "cursorjump", "EDS", "control", "older_control") )
```

